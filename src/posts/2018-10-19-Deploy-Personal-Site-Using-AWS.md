---
title: 'Deploy Personal Site Using AWS'
category: 'Web Development'
tags: [AWS, S3, CloudFront, Route53, Vue.js, JavaScript]
created: '2018-10-19'
updated:
status: publish
description: "In the previous post, it is illustrated how this website is built with Vue. For blogging, it is set up so that posts in Markdown are parsed by markdown-with-front-matter-loader. Also they are pre-generated by prerender-spa-plugin in production build. AWS has a comprehensive set of services for deploying a website and it'll be demonstrated how this site is deployed using them. Specifically the following serviced are used: S3 for static website hosting, Cloudfront for content delivery network and Route53 for Domain Name System (DNS) and Domain Name Registration."
---

In the [previous post](/blog/2018-10-10-Create-Personal-Site-with-Vue), it is illustrated how this website is built with [Vue](https://vuejs.org/). For blogging, it is set up so that posts in *Markdown* are parsed by *markdown-with-front-matter-loader*. Also they are pre-generated by *prerender-spa-plugin* in production build. AWS has a comprehensive set of services for deploying a website and it'll be demonstrated how this site is deployed using them. Specifically the following serviced are used: [S3](https://aws.amazon.com/s3/) for *static website hosting*, [Cloudfront](https://aws.amazon.com/cloudfront/) for *content delivery network* and [Route53](https://aws.amazon.com/route53/) for *Domain Name System (DNS) and Domain Name Registration*. 

## Deploy to S3

At first, it is necessary to create a S3 bucket. Note that S3 bucket name is globally unique so that it can be a good idea to think about a meaningful name before creating one - I chose *jaehyeon-me*. The bucket is created in *Asia Pacific (Sydney)* region which is close to where I live. Other than the name and region, I left everything else as default.

<div class="cover">
![](/static/2018-10-19-Deploy-Personal-Site-in-AWS/01_create_bucket.png)
</div>

<br>
Then the bucket policy needs to be updated so that all objects in the bucket are *public* accessible. Note that it is possible to restrict access to the objects using *CloudFront* and it'll be discussed in the next section.

<div class="cover">
![](/static/2018-10-19-Deploy-Personal-Site-in-AWS/02_bucket_policy.png)
</div>

<br>
To serve a Vue application, *Static website hosting* should be enabled in *Properties* tab.

<div class="cover">
![](/static/2018-10-19-Deploy-Personal-Site-in-AWS/03_static_website_hosting_01.png)
</div>

<br>
Because it is a single page application, both *Index* and *Error* documents are set to be *index.html*. The endpoint is created in the following convention.

```bash

http://<bucket-name>-website-<aws-region>.amazonaws.com
```

<div class="cover">
![](/static/2018-10-19-Deploy-Personal-Site-in-AWS/03_static_website_hosting_02.png)
</div>

<br>
Once the bucket is created, the distribution contents of the app is uploaded to it. Note that, thanks to *prerender-spa-plugin*, posts are pre-generated in *blog* folder.

<div class="cover">
![](/static/2018-10-19-Deploy-Personal-Site-in-AWS/00_upload.png)
</div>

## Add to CloudFront distribution

While it's possible to host the website, S3 static website hosting supports *HTTP* only and custom URL is not supported. Also, being hosted by a single region, it'll take longer to render the contents if it's visited by other regions. These issues can be handled by *CloudFront*.

Web distribution is created for this site.

<div class="cover">
![](/static/2018-10-19-Deploy-Personal-Site-in-AWS/04_cloudfront_01.png)
</div>

<br>
In *Origin Settings*, available *origin domain names* are populated in the drop down list. Initially I selected the one that associates with the bucket (*jaehyeon-me*) and later I found it has to be changed. Note that this bucket is created in *Asia Pacific (Sydney)*. However the populated value assumes it's created in the default region (*US East (N. Virginia)*). For non-default regions, the origin domain name should be in the following convention. (The initial and updated origin domain names can be found in the next successive screen shots.)

```bash

<bucket-name>.s3-website-<aws-region>.amazonaws.com
```

As mentioned above bucket access can be restricted by clicking *Yes* in *Restrict Bucket Access*. With this option selected, it's possible to create a new origin access identity or use an existing identity. Then the bucket policy can be updated so that objects can only be accessed by this identity. An example updated bucket policy can be found below.

```js

{
    "Version": "2008-10-17",
    "Id": "PolicyForCloudFrontPrivateContent",
    "Statement": [
        {
            "Sid": "1",
            "Effect": "Allow",
            "Principal": {
                "AWS": "arn:aws:iam::cloudfront:user/CloudFront Origin Access Identity <identity-id>"
            },
            "Action": "s3:GetObject",
            "Resource": "arn:aws:s3:::<bucket-name>/*"
        }
    ]
}
```

Finally, in *Default Cache Behavior Settings*, I selected *Redirect HTTP to HTTPS* only. (Note to check other options to see if it's posslbe to improve performance such as *Compress Objects Automatically*.)

<div class="cover">
![](/static/2018-10-19-Deploy-Personal-Site-in-AWS/04_cloudfront_02.png)
</div>

<div class="cover">
![](/static/2018-10-19-Deploy-Personal-Site-in-AWS/04_cloudfront_04.png)
</div>

<br>
In *Distribution Settings*, I added 2 *alternative domain names (CNAMEs)* - `www.jaehyeon.me` and `jaehyeon.me`. Both of them are necessary because it is planned to have the site visited by either. As I registered my domain (*jaehyeon.me*) in *Route53*, it's possible to select its SSL certificate in the drop down list.

<div class="cover">
![](/static/2018-10-19-Deploy-Personal-Site-in-AWS/04_cloudfront_03.png)
</div>

<br>
Once the distribution is enabled, it's possible to visit the website via `https://<distribution-id>.cloudfront.net`. 

## Route traffic to custom domain

In order to map the CloudFront distribution to the *CNAMEs*, 2 records sets of *A - IPv4 address* types are created. For `www.jaehyeon.me`, the name is set to be *www* while it is empty for `jaehyeon.me`. The same CloudFront distribution can be selected for *Alias Target* - it's possible as they are added in the CloudFront setting.

<div class="cover">
![](/static/2018-10-19-Deploy-Personal-Site-in-AWS/05_route53.png)
</div>

## Update CloudFront distribution

One last thing to consider is updating the CloudFront distribution. For example, when a new post is added, it should be updated. It can be done by *invalidation* followed by updating objects in the S3 bucket. The following screen shot shows an example of invalidating all objects (`/*`).

<div class="cover">
![](/static/2018-10-19-Deploy-Personal-Site-in-AWS/06_update.png)
</div>